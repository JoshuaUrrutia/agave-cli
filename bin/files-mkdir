#!/usr/bin/env python
"""
    Usage: files-mkdir [OPTIONS] agave://SYSTEM/PATH/NEW_DIR

Creates a directory on a Tapis storage system. Note that a system id, not a
hostname must be given and thus the new path must be specified as an Agave uri (agave://).

Flags:
    -h, --help            Display this help and exit
"""
from __future__ import print_function
import argparse
import sys
from agavepy.agave import Agave
from agavepy import utils

parser = argparse.ArgumentParser(
    description="Creates a directory on a Tapis storage system. The new path must be specified as an Agave URI (agave://system_id/destination/new_directory).")

parser.add_argument(
    "-c",
    "--cachedir",
    default=utils.credentials_cache_dir(),
    help="Session cache directory.")

parser.add_argument(
    "destination",
    action="store",
    help="Directory to make (Prefix with 'agave://')")

if __name__ == "__main__":
    try:
        args = parser.parse_args()
        cache_dir = args.cachedir
        destination = args.destination

        agave = Agave()
        agave.load_client(cache_dir)

        # Refresh tokens if necessary.
        agave.refresh_tokens()
        # Save out session cache
        if agave.client_name is not None:
            agave.save_configs(cache_dir)

        destination = destination[len("agave://"):]
        agave.files_mkdir(destination)
        sys.exit(0)

    except Exception as err:
        print(err)
        sys.exit(1)
