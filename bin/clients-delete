#!/usr/bin/env python
"""
    Usage: clients-delete [flags] [client name]

Deletes an oauth client.

Flags:
      -c, --cachedir    Directory where session configurations are saved
"""
from __future__ import print_function
import argparse
import os
import sys
from agavepy.agave import Agave

parser = argparse.ArgumentParser(description="Delete a Tapis Oauth client.")

parser.add_argument(
    "name", action="store", help="Name of Oauth client to delete")

parser.add_argument("-u", "--username", default=None, help="Tapis username.")
parser.add_argument("-p", "--password", default=None, help="Tapis password.")

parser.add_argument(
    "-c",
    "--cachedir",
    default=os.path.expanduser("~/.agave"),
    help="Directory where session configurations are saved.")

if __name__ == "__main__":
    args = parser.parse_args()

    username = args.username
    password = args.password

    agave = Agave()
    cache_dir = args.cachedir
    client_name = args.name

    config_file = os.path.join(cache_dir, 'config.json')
    # Check if there is a session already saved.
    if os.path.exists(config_file):
        agave.load_configs(cache_dir=cache_dir)
    else:
        print("You need to initiate a session first. Use auth-sessions-init")
        sys.exit(1)

    # List clients.
    try:
        agave.clients_delete(client_name, username=username,
                             password=password, quiet=False)
    except Exception as err:
        print(err)
        sys.exit(1)
