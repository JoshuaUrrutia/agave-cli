#!/usr/bin/env python
"""
    Usage: clients-subscriptions-update [OPTIONS] [CLIENT NAME]

Update or add API subscriptions for a Tapis Oauth client.

Flags:
    -N, --name          Client name.
    -a, --apiname       Name of the API to subscribe the client application to
    -r, --apiversion    Version of the API to subscribe the client application to
    -P, --apiprovider   User who registered the API
    -u, --username      Username.
    -p, --password      Password.
    -t, --tenant        Tenant id where client is registered.
    -c, --cachedir      Session cache directory.
    -h, --help          Display this help and exit
"""
from __future__ import print_function
import argparse
import os
import sys
from agavepy.agave import Agave
from agavepy import utils

parser = argparse.ArgumentParser(
    description="Updates or adds API subscriptions for a Tapis Oauth client.")

parser.add_argument("-N", "--name", help="Name of Oauth client.")
parser.add_argument(
    "-a",
    "--apiname",
    required=True,
    help="Name of the API to subscribe the client to.")
parser.add_argument(
    "-r",
    "--apiversion",
    required=True,
    help="Version of the API to subscribe the client to.")
parser.add_argument(
    "-P", "--apiprovider", required=True, help="User who registered the API.")

parser.add_argument("-u", "--username", default=None, help="Username.")
parser.add_argument("-p", "--password", default=None, help="Password.")
parser.add_argument("-t", "--tenant", default=None,
                    help="Tenant id where client is registered.")

parser.add_argument(
    "-c",
    "--cachedir",
    default=utils.credentials_cache_dir(),
    help="Session cache directory.")

if __name__ == "__main__":
    args = parser.parse_args()

    cache_dir = args.cachedir
    client_name = args.name
    api_name = args.apiname
    api_version = args.apiversion
    api_provider = args.apiprovider
    username = args.username
    password = args.password
    tenantid = args.tenant

    agave = Agave()
    context = utils.bootstrap_context(
        cache_dir, tenantid=tenantid, username=username)
    agave = Agave(tenant_id=context['tenantid'], username=context['username'])
    agave.init()

    # Subscribe Oauth client to api.
    try:
        agave.clients_subscribe(
            api_name, api_version, api_provider, client_name=client_name,
            password=password, quiet=False)
    except Exception as err:
        print(err)
        sys.exit(1)
