#!/usr/bin/env python
"""
    Usage: files-mv [OPTIONS] agave://SYSTEM/SOURCE agave://SYSTEM/DESTINATION

Moves a file or folder from one location to another on a Tapis system. This
is akin to the UNIX 'mv' command. The paths must be specified as Agave URI (
    i.e. agave://tacc-data-user/path/to/source)

Flags:
    -c, --cachedir    Session cache directory..
"""
from __future__ import print_function
import argparse
import sys
from agavepy.agave import Agave
from agavepy import utils

parser = argparse.ArgumentParser(
    description="Moves (renames) a file or folder from one location to another on a Tapis system. This is akin to the UNIX `mv` command. Source and destination paths must be specififed as Agave URIs.")

parser.add_argument(
    "-c",
    "--cachedir",
    default=utils.credentials_cache_dir(),
    help="Session cache directory.")

parser.add_argument(
    "source", action="store", help="Source (Prefix with 'agave://')")

parser.add_argument(
    "destination", action="store", help="Destination (Prefix with 'agave://')")

if __name__ == "__main__":
    try:
        args = parser.parse_args()
        cache_dir = args.cachedir
        source = args.source
        destination = args.destination

        agave = Agave()
        agave.load_client(cache_dir)

        # Refresh tokens if necessary.
        agave.refresh_tokens()
        # Save out session cache
        if agave.client_name is not None:
            agave.save_configs(cache_dir)
        # Refresh tokens if necessary.
        agave.refresh_tokens()

        source = source[len("agave://"):]
        destination = destination[len("agave://"):]
        agave.files_copy(source, destination)
        sys.exit(0)

    except Exception as err:
        print(err)
        sys.exit(1)
